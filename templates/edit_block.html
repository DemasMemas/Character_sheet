<div class="block"
     data-block-id="{{ block.id }}"
     data-block-type="{{ block.type }}"
     style="left: {{ block.position_x }}px;
            top: {{ block.position_y }}px;
            width: {{ block.width }}px;
            height: {{ block.height }}px;
            background-color: {{ block.color }};">

  <div class="block-header">
    {% if block.type == 'text' or block.type == 'weapon' or block.type == 'armor' or
          block.type == 'inventory' or block.type == 'character_info' or
          block.type == 'helmet' or block.type == 'table' %}
      <div class="block-title editable-field" contenteditable="true" data-field="name">
        {{ block.data.get('name', '–ù–æ–≤—ã–π –±–ª–æ–∫') }}
      </div>
    {% else %}
      <div class="block-title">{{ block.type }}</div>
    {% endif %}

    <div class="block-actions">
      <button class="btn btn-sm btn-outline-secondary color-trigger">üé®</button>
      <button class="btn btn-sm btn-danger delete-block">√ó</button>
    </div>
  </div>

  <div class="block-content">
    {% if block.type == 'text' %}
      <div class="editable-field" contenteditable="true" data-field="content">
        {{ block.data.get('content', '–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –∑–¥–µ—Å—å...') }}
      </div>

    {% elif block.type == 'weapon' %}
      <div class="mb-2">
        <label>–£—Ä–æ–Ω:</label>
        <span class="editable-field" contenteditable="true" data-field="damage">
          {{ block.data.get('damage', '10') }}
        </span>
      </div>
      <div class="mb-2">
        <label>–¢–æ—á–Ω–æ—Å—Ç—å:</label>
        <span class="editable-field" contenteditable="true" data-field="accuracy">
          {{ block.data.get('accuracy', '75') }}
        </span>%
      </div>
      <div class="mb-2">
        <label>–í–µ—Å:</label>
        <span class="editable-field" contenteditable="true" data-field="weight">
          {{ block.data.get('weight', '3.5') }}
        </span> –∫–≥
      </div>
      <div class="action-buttons mt-3">
        <button class="btn btn-sm btn-primary action-btn" data-action="roll_attack">
          –ê—Ç–∞–∫–æ–≤–∞—Ç—å (D20)
        </button>
      </div>

    {% elif block.type == 'armor' %}
      <div class="mb-2">
        <label>–ó–∞—â–∏—Ç–∞:</label>
        <span class="editable-field" contenteditable="true" data-field="defense">
          {{ block.data.get('defense', '5') }}
        </span>
      </div>
      <div class="mb-2">
        <label>–ü—Ä–æ—á–Ω–æ—Å—Ç—å:</label>
        <span class="editable-field" contenteditable="true" data-field="durability">
          {{ block.data.get('durability', '100') }}
        </span>
      </div>
      <div class="mb-2">
        <label>–í–µ—Å:</label>
        <span class="editable-field" contenteditable="true" data-field="armor_weight">
          {{ block.data.get('armor_weight', '8.5') }}
        </span> –∫–≥
      </div>

    {% elif block.type == 'helmet' %}
      <div class="mb-2">
        <label>–ó–∞—â–∏—Ç–∞ –≥–æ–ª–æ–≤—ã:</label>
        <span class="editable-field" contenteditable="true" data-field="head_defense">
          {{ block.data.get('head_defense', '3') }}
        </span>
      </div>
      <div class="mb-2">
        <label>–®—Ç—Ä–∞—Ñ –∫ –æ–±–∑–æ—Ä—É:</label>
        <span class="editable-field" contenteditable="true" data-field="vision_penalty">
          {{ block.data.get('vision_penalty', '10') }}
        </span>%
      </div>
      <div class="mb-2">
        <label>–í–µ—Å:</label>
        <span class="editable-field" contenteditable="true" data-field="helmet_weight">
          {{ block.data.get('helmet_weight', '2.5') }}
        </span> –∫–≥
      </div>

    {% elif block.type == 'inventory' %}
      <div class="mb-2">
        <label>–í–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:</label>
        <span class="editable-field" contenteditable="true" data-field="capacity">
          {{ block.data.get('capacity', '50') }}
        </span> –∫–≥
      </div>
      <div class="mt-3">
        <button class="btn btn-sm btn-outline-success add-item-btn">+ –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–µ–¥–º–µ—Ç</button>
      </div>
      <div class="items-container mt-2">
        {% for item in block.data.get('items', []) %}
          <div class="item mb-2 p-2 border">
            <div class="d-flex justify-content-between">
              <div>
                <span class="editable-field" contenteditable="true" data-field="items.{{ loop.index0 }}.name">
                  {{ item.get('name', '–ü—Ä–µ–¥–º–µ—Ç') }}
                </span>
              </div>
              <button class="btn btn-sm btn-danger delete-item">√ó</button>
            </div>
            <div class="row mt-1">
              <div class="col">
                <label>–ö–æ–ª-–≤–æ:</label>
                <span class="editable-field" contenteditable="true" data-field="items.{{ loop.index0 }}.quantity">
                  {{ item.get('quantity', 1) }}
                </span>
              </div>
              <div class="col">
                <label>–í–µ—Å:</label>
                <span class="editable-field" contenteditable="true" data-field="items.{{ loop.index0 }}.weight">
                  {{ item.get('weight', 0.1) }}
                </span> –∫–≥
              </div>
            </div>
          </div>
        {% endfor %}
      </div>

    {% elif block.type == 'character_info' %}
      <div class="mb-2">
        <label>–ò–º—è:</label>
        <span class="editable-field" contenteditable="true" data-field="first_name">
          {{ character.first_name }}
        </span>
      </div>
      <div class="mb-2">
        <label>–§–∞–º–∏–ª–∏—è:</label>
        <span class="editable-field" contenteditable="true" data-field="last_name">
          {{ character.last_name }}
        </span>
      </div>
      <div class="mb-2">
        <label>–í–æ–∑—Ä–∞—Å—Ç:</label>
        <span class="editable-field" contenteditable="true" data-field="age">
          {{ character.age or '‚Äî' }}
        </span>
      </div>
      <div class="mb-2">
        <label>–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞:</label>
        <span class="editable-field" contenteditable="true" data-field="faction">
          {{ character.faction or '‚Äî' }}
        </span>
      </div>
      <div class="mb-2">
        <label>–ü–µ—Ä–µ–Ω–æ—Å–∏–º—ã–π –≤–µ—Å:</label>
        <span class="editable-field" contenteditable="true" data-field="carry_weight">
          {{ character.carry_weight or '‚Äî' }}
        </span> –∫–≥
      </div>

    {% elif block.type == 'table' %}
    <div class="table-responsive">
      <table class="table table-sm">
        <thead>
          <tr>
            {% for header in block.data.get('headers', ['–ù–æ–≤—ã–π —Å—Ç–æ–ª–±–µ—Ü']) %}
              <th>
                <div class="d-flex justify-content-between align-items-center">
                  <div class="editable-field" contenteditable="true"
                       data-field="header_{{ loop.index0 }}">{{ header }}</div>
                  <button class="btn btn-sm btn-outline-danger delete-col-btn action-button"
                          data-col-index="{{ loop.index0 }}">√ó</button>
                </div>
              </th>
            {% endfor %}
            <th class="align-middle">
              <button class="btn btn-sm btn-outline-success add-column action-button">+</button>
            </th>
          </tr>
        </thead>
        <tbody>
          {% for row in block.data.get('rows', [['–ù–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞']]) %}
            <tr class="table-row">
              {% for cell in row %}
                <td>
                  <div class="editable-field" contenteditable="true"
                       data-field="row_{{ loop.index0 }}_col_{{ loop.index0 }}">{{ cell }}</div>
                </td>
              {% endfor %}
              <td class="align-middle text-center">
                <button class="btn btn-sm btn-outline-danger delete-row-btn action-button"
                        data-row-index="{{ loop.index0 }}">√ó</button>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
      <button class="btn btn-sm btn-outline-primary add-row mt-2">+ –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É</button>
    </div>
    {% endif %}
  </div>

  <div class="color-picker" style="display: none;">
    {% for color in ['#ffffff', '#ffebee', '#f3e5f5', '#e8eaf6', '#e3f2fd', '#e0f7fa', '#e8f5e9', '#fffde7', '#fff3e0', '#efebe9'] %}
      <div class="color-option" style="background-color: {{ color }};" data-color="{{ color }}"></div>
    {% endfor %}
  </div>

</div>